<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<style>
			html{
				background:url(img/2.jpg) no-repeat;
			}
			.Title{
				text-align:center;
				background:white;
				opacity:0.9;
			}
			.Text{
				background:white;
				opacity:0.9;
			}
		</style>
	</head>
	<body>
		<div class="Title">
			<h1>Hello</h1>
		</div>
		<div class="Text">
			<p>asd</p>
			<p>das</p>
			<!--
			<div  id='write'  class = ''><p><strong><span>这题的一个关键就是拆分一个操作</span></strong></p><p><span>比如第二种操作x y col1 col2,实际上可以拆成以下的操作：</span></p><ol start='' ><li><span>将x到y路径上每个点所有指向儿子的边颜色改为col_2</span></li><li><span>将x到y路径上每个点指向父亲的边的颜色改为col_1</span></li><li><span>将x和y的LCA指向父亲的边改为col_2</span></li></ol><p><span>那么这样本题就变成了4种操作：</span></p><ol start='' ><li><span>链修改指向儿子的边</span></li><li><span>修改链</span></li><li><span>修改子树（换根）</span></li><li><span>链询问</span></li></ol><p><span>咱们先不考虑比较恶心的操作1. 可以发现其他操作是可以树剖+线段树的，把边都放在儿子上，线段树上每个点记录各个颜色的出现次数，以及标记修改的懒惰标记。</span></p><p><span>难点在于操作3，这里需要分类讨论：</span></p><p><span>我们令以1为根的树为原树。</span></p><ul><li><span>如果rt不在”x在原树中的子树“中，那么其实就是修改原树中的子树</span></li><li><span>如果rt==x,那么就是修改整棵树</span></li><li><span>如果rt在“y(y为x的某一个儿子)的子树”中时，那么需要修改的部分就是“原树中x的子树除去y的子树”。</span></li></ul><p><span>都可以将修改部分化为dfs序上的连续区间。对于第三种情况如何求y，也可以树链剖分（不嫌麻烦倍增也可以）。</span></p><p><span>现在考虑比较恶心的操作1.</span></p><p><span>可以类似懒惰标记一样在线段树维护一个col_son，表示指向儿子所有轻边的颜色。所以在考虑轻边的时候需要考虑两个情况，是由父亲转移下来或者是由儿子转移上去，所以还需记录一个打标记时的时间避免两种标记冲突。</span></p><p><span>细节是十分的多。最终复杂度两个log.所以常数要比较优秀。</span></p><p><span>（标程常数很大，可读性很差。。）</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#pragma GCC optimize(2)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include&lt;bits/stdc++.h&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define ls o&lt;&lt;1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define rs o&lt;&lt;1|1</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define init (node){-1,-1}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#define ll long long int</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">using</span> <span class="cm-keyword">namespace</span> <span class="cm-def">std</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable-3">int</span> <span class="cm-variable">maxn</span><span class="cm-operator">=</span><span class="cm-number">1e5</span><span class="cm-operator">+</span><span class="cm-number">7</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">n</span>,<span class="cm-variable">m</span>,<span class="cm-variable">cnt</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">tot</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">tmp</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">son</span>[<span class="cm-variable">maxn</span>]<span class="cm-operator">=</span>{<span class="cm-number">0</span>},<span class="cm-variable">dep</span>[<span class="cm-variable">maxn</span>]<span class="cm-operator">=</span>{<span class="cm-number">0</span>},<span class="cm-variable">tr</span>[<span class="cm-variable">maxn</span>]<span class="cm-operator">=</span>{<span class="cm-number">0</span>},<span class="cm-variable">fa</span>[<span class="cm-variable">maxn</span>]<span class="cm-operator">=</span>{<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">siz</span>[<span class="cm-variable">maxn</span>],<span class="cm-variable">top</span>[<span class="cm-variable">maxn</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">head</span>[<span class="cm-variable">maxn</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">edge</span>{<span class="cm-variable-3">int</span> <span class="cm-variable">v</span>,<span class="cm-variable">nxt</span>;}<span class="cm-variable">e</span>[<span class="cm-variable">maxn</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">1</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">node</span>{<span class="cm-variable-3">int</span> <span class="cm-variable">t</span>,<span class="cm-variable">w</span>;};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">struct</span> <span class="cm-def">tree</span>{<span class="cm-variable-3">int</span> <span class="cm-variable">sum</span>[<span class="cm-number">3</span>],<span class="cm-variable">siz</span>;<span class="cm-variable">node</span> <span class="cm-variable">tag</span>,<span class="cm-variable">son</span>;}<span class="cm-variable">t</span>[<span class="cm-variable">maxn</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">2</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">add</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>){<span class="cm-variable">e</span>[<span class="cm-operator">++</span><span class="cm-variable">tot</span>]<span class="cm-operator">=</span>(<span class="cm-variable">edge</span>){<span class="cm-variable">y</span>,<span class="cm-variable">head</span>[<span class="cm-variable">x</span>]},<span class="cm-variable">head</span>[<span class="cm-variable">x</span>]<span class="cm-operator">=</span><span class="cm-variable">tot</span>;}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">dfs1</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">siz</span>[<span class="cm-variable">x</span>]<span class="cm-operator">=</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-variable">head</span>[<span class="cm-variable">x</span>];<span class="cm-variable">i</span>;<span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-variable">e</span>[<span class="cm-variable">i</span>].<span class="cm-variable">nxt</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">v</span><span class="cm-operator">=</span><span class="cm-variable">e</span>[<span class="cm-variable">i</span>].<span class="cm-variable">v</span>;<span class="cm-keyword">if</span> (<span class="cm-variable">v</span><span class="cm-operator">==</span><span class="cm-variable">fa</span>[<span class="cm-variable">x</span>]) <span class="cm-keyword">continue</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fa</span>[<span class="cm-variable">v</span>]<span class="cm-operator">=</span><span class="cm-variable">x</span>,<span class="cm-variable">dep</span>[<span class="cm-variable">v</span>]<span class="cm-operator">=</span><span class="cm-variable">dep</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">dfs1</span>(<span class="cm-variable">v</span>),<span class="cm-variable">siz</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+=</span><span class="cm-variable">siz</span>[<span class="cm-variable">v</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">siz</span>[<span class="cm-variable">v</span>]<span class="cm-operator">&gt;</span><span class="cm-variable">siz</span>[<span class="cm-variable">son</span>[<span class="cm-variable">x</span>]]) <span class="cm-variable">son</span>[<span class="cm-variable">x</span>]<span class="cm-operator">=</span><span class="cm-variable">v</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">dfs2</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">h</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">top</span>[<span class="cm-variable">x</span>]<span class="cm-operator">=</span><span class="cm-variable">h</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">=++</span><span class="cm-variable">tmp</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">son</span>[<span class="cm-variable">x</span>]) <span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dfs2</span>(<span class="cm-variable">son</span>[<span class="cm-variable">x</span>],<span class="cm-variable">h</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-variable">head</span>[<span class="cm-variable">x</span>];<span class="cm-variable">i</span>;<span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-variable">e</span>[<span class="cm-variable">i</span>].<span class="cm-variable">nxt</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">v</span><span class="cm-operator">=</span><span class="cm-variable">e</span>[<span class="cm-variable">i</span>].<span class="cm-variable">v</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">v</span><span class="cm-operator">!=</span><span class="cm-variable">son</span>[<span class="cm-variable">x</span>]<span class="cm-operator">&amp;&amp;</span><span class="cm-variable">v</span><span class="cm-operator">!=</span><span class="cm-variable">fa</span>[<span class="cm-variable">x</span>]) <span class="cm-variable">dfs2</span>(<span class="cm-variable">v</span>,<span class="cm-variable">v</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">build</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">l</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">r</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">sum</span>[<span class="cm-number">0</span>]<span class="cm-operator">=</span><span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">siz</span><span class="cm-operator">=</span><span class="cm-variable">r</span><span class="cm-operator">-</span><span class="cm-variable">l</span><span class="cm-operator">+</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span><span class="cm-operator">=</span><span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span><span class="cm-operator">=</span><span class="cm-variable">init</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">l</span><span class="cm-operator">==</span><span class="cm-variable">r</span>) {<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span><span class="cm-operator">=</span>(<span class="cm-variable">node</span>){<span class="cm-number">0</span>,<span class="cm-number">0</span>};<span class="cm-keyword">return</span> ;}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mid</span><span class="cm-operator">=</span><span class="cm-variable">l</span><span class="cm-operator">+</span><span class="cm-variable">r</span><span class="cm-operator">&gt;&gt;</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">build</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>),<span class="cm-variable">build</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">change</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>,<span class="cm-variable">node</span> <span class="cm-variable">k</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span>) {<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>) <span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">sum</span>[<span class="cm-variable">i</span>]<span class="cm-operator">=</span><span class="cm-variable">i</span><span class="cm-operator">==</span><span class="cm-variable">k</span>.<span class="cm-variable">w</span><span class="cm-operator">?</span><span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">siz</span>:<span class="cm-number">0</span>;<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span><span class="cm-operator">=</span><span class="cm-variable">k</span>;}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span><span class="cm-operator">=</span><span class="cm-variable">k</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">up</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>){<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>) <span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">sum</span>[<span class="cm-variable">i</span>]<span class="cm-operator">=</span><span class="cm-variable">t</span>[<span class="cm-variable">ls</span>].<span class="cm-variable">sum</span>[<span class="cm-variable">i</span>]<span class="cm-operator">+</span><span class="cm-variable">t</span>[<span class="cm-variable">rs</span>].<span class="cm-variable">sum</span>[<span class="cm-variable">i</span>];}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">down</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span>.<span class="cm-variable">t</span><span class="cm-operator">!=-</span><span class="cm-number">1</span>) <span class="cm-variable">change</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span>,<span class="cm-number">1</span>),<span class="cm-variable">change</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span>,<span class="cm-number">1</span>),<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span><span class="cm-operator">=</span><span class="cm-variable">init</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span>.<span class="cm-variable">t</span><span class="cm-operator">!=-</span><span class="cm-number">1</span>) <span class="cm-variable">change</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span>,<span class="cm-number">0</span>),<span class="cm-variable">change</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span>,<span class="cm-number">0</span>),<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span><span class="cm-operator">=</span><span class="cm-variable">init</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">ins</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">l</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">r</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>,<span class="cm-variable">node</span> <span class="cm-variable">k</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-variable">y</span>) <span class="cm-keyword">return</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">==</span><span class="cm-variable">l</span><span class="cm-operator">&amp;&amp;</span><span class="cm-variable">r</span><span class="cm-operator">==</span><span class="cm-variable">y</span>) {<span class="cm-variable">change</span>(<span class="cm-variable">o</span>,<span class="cm-variable">k</span>,<span class="cm-variable">f</span>);<span class="cm-keyword">return</span> ;}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">down</span>(<span class="cm-variable">o</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mid</span><span class="cm-operator">=</span><span class="cm-variable">l</span><span class="cm-operator">+</span><span class="cm-variable">r</span><span class="cm-operator">&gt;&gt;</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">y</span><span class="cm-operator">&lt;=</span><span class="cm-variable">mid</span>) <span class="cm-variable">ins</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-variable">mid</span>) <span class="cm-variable">ins</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>,<span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">ins</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">x</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">k</span>),<span class="cm-variable">ins</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">up</span>(<span class="cm-variable">o</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">update</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">c1</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">c2</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-operator">++</span><span class="cm-variable">cnt</span>;<span class="cm-variable">node</span> <span class="cm-variable">l</span><span class="cm-operator">=</span>(<span class="cm-variable">node</span>){<span class="cm-variable">cnt</span>,<span class="cm-variable">c1</span>},<span class="cm-variable">r</span><span class="cm-operator">=</span>(<span class="cm-variable">node</span>){<span class="cm-variable">cnt</span>,<span class="cm-variable">c2</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">f1</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">x</span>],<span class="cm-variable">f2</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">y</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">f1^f2</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">dep</span>[<span class="cm-variable">f1</span>]<span class="cm-operator">&lt;</span><span class="cm-variable">dep</span>[<span class="cm-variable">f2</span>]) <span class="cm-variable">swap</span>(<span class="cm-variable">f1</span>,<span class="cm-variable">f2</span>),<span class="cm-variable">swap</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">f1</span>],<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">f1</span>],<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">l</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">son</span>[<span class="cm-variable">x</span>]) <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">fa</span>[<span class="cm-variable">f1</span>];<span class="cm-variable">f1</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">x</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">&gt;</span><span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]) <span class="cm-variable">swap</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">tr</span>[<span class="cm-variable">y</span>],<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">1</span>,<span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">y</span>],<span class="cm-variable">l</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">son</span>[<span class="cm-variable">y</span>]) <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">int</span> <span class="cm-def">query</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">l</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">r</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">k</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">==</span><span class="cm-variable">l</span><span class="cm-operator">&amp;&amp;</span><span class="cm-variable">y</span><span class="cm-operator">==</span><span class="cm-variable">r</span>) <span class="cm-keyword">return</span> <span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">sum</span>[<span class="cm-variable">k</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-variable">r</span><span class="cm-operator">||</span><span class="cm-variable">y</span><span class="cm-operator">&lt;</span><span class="cm-variable">l</span><span class="cm-operator">||</span><span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-variable">y</span>) <span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">down</span>(<span class="cm-variable">o</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mid</span><span class="cm-operator">=</span><span class="cm-variable">l</span><span class="cm-operator">+</span><span class="cm-variable">r</span><span class="cm-operator">&gt;&gt;</span><span class="cm-number">1</span>,<span class="cm-variable">ans</span><span class="cm-operator">=</span><span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">y</span><span class="cm-operator">&lt;=</span><span class="cm-variable">mid</span>) <span class="cm-variable">ans</span><span class="cm-operator">=</span><span class="cm-variable">query</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-variable">mid</span>) <span class="cm-variable">ans</span><span class="cm-operator">=</span><span class="cm-variable">query</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>,<span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">ans</span><span class="cm-operator">=</span><span class="cm-variable">query</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">x</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">k</span>)<span class="cm-operator">+</span><span class="cm-variable">query</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">y</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ans</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable">node</span> <span class="cm-def">ask</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">o</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">l</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">r</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">k</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">l</span><span class="cm-operator">==</span><span class="cm-variable">r</span>) <span class="cm-keyword">return</span> <span class="cm-variable">k</span><span class="cm-operator">?</span><span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">tag</span>:<span class="cm-variable">t</span>[<span class="cm-variable">o</span>].<span class="cm-variable">son</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">down</span>(<span class="cm-variable">o</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">mid</span><span class="cm-operator">=</span><span class="cm-variable">l</span><span class="cm-operator">+</span><span class="cm-variable">r</span><span class="cm-operator">&gt;&gt;</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span><span class="cm-operator">&lt;=</span><span class="cm-variable">mid</span><span class="cm-operator">?</span><span class="cm-variable">ask</span>(<span class="cm-variable">ls</span>,<span class="cm-variable">l</span>,<span class="cm-variable">mid</span>,<span class="cm-variable">x</span>,<span class="cm-variable">k</span>):<span class="cm-variable">ask</span>(<span class="cm-variable">rs</span>,<span class="cm-variable">mid</span><span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>,<span class="cm-variable">x</span>,<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">int</span> <span class="cm-def">solve</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">k</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">f1</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">x</span>],<span class="cm-variable">f2</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">y</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">ans</span><span class="cm-operator">=</span><span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">f1^f2</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">dep</span>[<span class="cm-variable">f1</span>]<span class="cm-operator">&lt;</span><span class="cm-variable">dep</span>[<span class="cm-variable">f2</span>]) <span class="cm-variable">swap</span>(<span class="cm-variable">f1</span>,<span class="cm-variable">f2</span>),<span class="cm-variable">swap</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ans</span><span class="cm-operator">+=</span><span class="cm-variable">query</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">f1</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>],<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">node</span> <span class="cm-variable">l</span><span class="cm-operator">=</span><span class="cm-variable">ask</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">f1</span>],<span class="cm-number">1</span>),<span class="cm-variable">r</span><span class="cm-operator">=</span><span class="cm-variable">ask</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">fa</span>[<span class="cm-variable">f1</span>]],<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">l</span>.<span class="cm-variable">t</span><span class="cm-operator">&gt;=</span><span class="cm-variable">r</span>.<span class="cm-variable">t</span>) <span class="cm-variable">ans</span><span class="cm-operator">+=</span><span class="cm-variable">l</span>.<span class="cm-variable">w</span><span class="cm-operator">==</span><span class="cm-variable">k</span>;<span class="cm-keyword">else</span> <span class="cm-variable">ans</span><span class="cm-operator">+=</span><span class="cm-variable">r</span>.<span class="cm-variable">w</span><span class="cm-operator">==</span><span class="cm-variable">k</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">fa</span>[<span class="cm-variable">f1</span>];<span class="cm-variable">f1</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">x</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">==</span><span class="cm-variable">y</span>) <span class="cm-keyword">return</span> <span class="cm-variable">ans</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">&gt;</span><span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]) <span class="cm-variable">swap</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ans</span><span class="cm-operator">+</span><span class="cm-variable">query</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">x</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">y</span>],<span class="cm-variable">k</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">int</span> <span class="cm-def">child</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable-3">int</span> <span class="cm-variable">y</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">t</span>,<span class="cm-variable">f1</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">x</span>],<span class="cm-variable">f2</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">y</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">f1^f2</span>) <span class="cm-variable">t</span><span class="cm-operator">=</span><span class="cm-variable">f2</span>,<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">fa</span>[<span class="cm-variable">f2</span>],<span class="cm-variable">f2</span><span class="cm-operator">=</span><span class="cm-variable">top</span>[<span class="cm-variable">y</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x^y</span>) <span class="cm-keyword">return</span> <span class="cm-variable">son</span>[<span class="cm-variable">x</span>];</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">return</span> <span class="cm-variable">t</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">int</span> <span class="cm-def">read</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-number">0</span>,<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">1</span>;<span class="cm-variable-3">char</span> <span class="cm-variable">ch</span><span class="cm-operator">=</span><span class="cm-variable">getchar</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">ch</span><span class="cm-operator">&lt;</span><span class="cm-string">'0'</span><span class="cm-operator">||</span><span class="cm-variable">ch</span><span class="cm-operator">&gt;</span><span class="cm-string">'9'</span>){<span class="cm-keyword">if</span> (<span class="cm-variable">ch</span><span class="cm-operator">==</span><span class="cm-string">'-'</span>) <span class="cm-variable">f</span><span class="cm-operator">=-</span><span class="cm-number">1</span>;<span class="cm-variable">ch</span><span class="cm-operator">=</span><span class="cm-variable">getchar</span>();}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-variable">ch</span><span class="cm-operator">&gt;=</span><span class="cm-string">'0'</span><span class="cm-operator">&amp;&amp;</span><span class="cm-variable">ch</span><span class="cm-operator">&lt;=</span><span class="cm-string">'9'</span>) <span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">x</span><span class="cm-operator">*</span><span class="cm-number">10</span><span class="cm-operator">+</span><span class="cm-variable">ch</span><span class="cm-operator">-</span><span class="cm-string">'0'</span>,<span class="cm-variable">ch</span><span class="cm-operator">=</span><span class="cm-variable">getchar</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">x</span><span class="cm-operator">*</span><span class="cm-variable">f</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">writ</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">x</span><span class="cm-operator">&lt;</span><span class="cm-number">0</span>) <span class="cm-variable">putchar</span>(<span class="cm-string">'-'</span>),<span class="cm-variable">x</span><span class="cm-operator">=-</span><span class="cm-variable">x</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">x</span><span class="cm-operator">&gt;</span><span class="cm-number">9</span>) <span class="cm-variable">writ</span>(<span class="cm-variable">x</span><span class="cm-operator">/</span><span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">putchar</span>(<span class="cm-variable">x</span><span class="cm-operator">%</span><span class="cm-number">10</span><span class="cm-operator">+</span><span class="cm-string">'0'</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">write</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>){<span class="cm-variable">writ</span>(<span class="cm-variable">x</span>);<span class="cm-variable">putchar</span>(<span class="cm-string">'\n'</span>);}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">inline</span> <span class="cm-variable-3">void</span> <span class="cm-def">writt</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>){<span class="cm-variable">writ</span>(<span class="cm-variable">x</span>);<span class="cm-variable">putchar</span>(<span class="cm-string">' '</span>);}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">n</span><span class="cm-operator">=</span><span class="cm-variable">read</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">1</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">n</span>;<span class="cm-variable">i</span><span class="cm-operator">++</span>) {<span class="cm-variable-3">int</span> <span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">read</span>(),<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">read</span>();<span class="cm-variable">add</span>(<span class="cm-variable">x</span>,<span class="cm-variable">y</span>),<span class="cm-variable">add</span>(<span class="cm-variable">y</span>,<span class="cm-variable">x</span>);}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dfs1</span>(<span class="cm-number">1</span>),<span class="cm-variable">dfs2</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>),<span class="cm-variable">build</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">m</span><span class="cm-operator">=</span><span class="cm-variable">read</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">1</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;=</span><span class="cm-variable">m</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">z</span>,<span class="cm-variable">k</span>,<span class="cm-variable">s</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x</span><span class="cm-operator">=</span><span class="cm-variable">read</span>(),<span class="cm-variable">y</span><span class="cm-operator">=</span><span class="cm-variable">read</span>(),<span class="cm-variable">z</span><span class="cm-operator">=</span><span class="cm-variable">read</span>(),<span class="cm-variable">k</span><span class="cm-operator">=</span><span class="cm-variable">read</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">==</span><span class="cm-number">1</span>) <span class="cm-variable">write</span>(<span class="cm-variable">solve</span>(<span class="cm-variable">y</span>,<span class="cm-variable">z</span>,<span class="cm-variable">k</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">x</span><span class="cm-operator">==</span><span class="cm-number">3</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">node</span> <span class="cm-variable">r</span><span class="cm-operator">=</span>(<span class="cm-variable">node</span>){<span class="cm-operator">++</span><span class="cm-variable">cnt</span>,<span class="cm-variable">k</span>};<span class="cm-variable">f</span><span class="cm-operator">=</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">z</span><span class="cm-operator">==</span><span class="cm-variable">y</span>) <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable">tr</span>[<span class="cm-variable">z</span>]<span class="cm-operator">+</span><span class="cm-variable">siz</span>[<span class="cm-variable">z</span>]<span class="cm-operator">&gt;</span><span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]<span class="cm-operator">&amp;&amp;</span><span class="cm-variable">tr</span>[<span class="cm-variable">z</span>]<span class="cm-operator">&lt;=</span><span class="cm-variable">tr</span>[<span class="cm-variable">y</span>]){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">s</span><span class="cm-operator">=</span><span class="cm-variable">child</span>(<span class="cm-variable">z</span>,<span class="cm-variable">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tr</span>[<span class="cm-variable">s</span>]<span class="cm-operator">&gt;=</span><span class="cm-number">1</span>) <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">s</span>]<span class="cm-operator">-</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">tr</span>[<span class="cm-variable">s</span>]<span class="cm-operator">+</span><span class="cm-variable">siz</span>[<span class="cm-variable">s</span>]<span class="cm-operator">&lt;=</span><span class="cm-variable">n</span>) <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">s</span>]<span class="cm-operator">+</span><span class="cm-variable">siz</span>[<span class="cm-variable">s</span>],<span class="cm-variable">n</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">ins</span>(<span class="cm-number">1</span>,<span class="cm-number">1</span>,<span class="cm-variable">n</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">z</span>]<span class="cm-operator">+</span><span class="cm-number">1</span>,<span class="cm-variable">tr</span>[<span class="cm-variable">z</span>]<span class="cm-operator">+</span><span class="cm-variable">siz</span>[<span class="cm-variable">z</span>]<span class="cm-operator">-</span><span class="cm-number">1</span>,<span class="cm-variable">r</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span> <span class="cm-variable">s</span><span class="cm-operator">=</span><span class="cm-variable">read</span>(),<span class="cm-variable">update</span>(<span class="cm-variable">y</span>,<span class="cm-variable">z</span>,<span class="cm-variable">k</span>,<span class="cm-variable">s</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 3427px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3427px;"></div></div></div></pre><p>&nbsp;</p></div>
			-->
		</div>
	</body>
</html>